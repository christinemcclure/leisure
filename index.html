<!DOCTYPE>
<html>
  <head>
    <meta charset="utf-8">
    <title>Leisure Reading</title>
    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
          
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script>
      $(document).ready(function(){


        function emptyContainer(){
            var bookElements = new Array ("#bookTitle","#bookAuthor","#bookDescText","#showOPACbtn");
            bookElements.forEach(function(ele){
               $(ele).empty();
            });
        }
        
        function pad0(item){
            item += ''; //convert to string
            var len = item.length;
            if (item.length < 2)
                item = '0'+ item;
            return item;
        }
        
        function formatDateTime(){//obj is the element to write the date to
            var monthArr = new Array ('January', 'February','March','April','May','June','July','August','September','October','November','December');
            var monthNum = dateObj.getMonth();
            var day = dateObj.getDay();
            var meridian = "";
            var hour = dateObj.getHours();
                if (hour > 12){// sadly, we don't use military time in this country
                    hour = hour - 12;
                    meridian = 'pm';
                }
                else {
                    meridian = 'am';
                }
            var minutes = dateObj.getMinutes();
                minutes = pad0(minutes);

            var newDate = monthArr[monthNum] + ' ' + day + ', ' + dateObj.getFullYear() + ' ' + hour + ":" + minutes + meridian;
            return(newDate);
        }

        function loadRandomBook(){

            var truncLen = 200;
            var numBooks = Books.length;
            var randomNum=Math.floor(Math.random()*(numBooks))
            var book = Books[randomNum];
            var bookURL = 'https://vufind.carli.illinois.edu/vf-iit/Search/Home?lookfor=' + book.isbn + '&type=all&start_over=1&submit=Find&search=new';
            if (!book.description)
              var randomBookDescText = "No description available.";
            else
              var randomBookDescText = book.description;
            
            if (randomBookDescText.length > truncLen) {
               var descTrunc = randomBookDescText.substring(0,truncLen) + "...";
            }


            emptyContainer();

            $('#bookTitle').append($('<p>').html(book.title));
            $('#bookAuthor').append($('<p>').html(book.author));

            if (descTrunc){
              $('#bookDescText').html('<p>'+descTrunc+'<button id=\'showFull\' class=\"btn btn-info btn-xs\">Show full description</button></p>');
            }
            else {
              $('#bookDescText').append($('<p>').html(randomBookDescText));
            }

            $('#showOPACbtn').html('<button class="btn btn-success">Interesting. Is it checked out?</a></button>');
            $('#newBookBtn').html( '<button class="btn btn-danger">No, thanks. Show me another book</button>');

            $( "#showFull" ).bind( "click", function( ) { // add click event for dynamically-created element
               $('#bookDescText').empty();
               $('#bookDescText').append($('<p>').html(randomBookDescText));
            });
            $( "#showOPACbtn" ).bind( "click", function( ) { // add click event for dynamically-created element
              window.location.href=bookURL;
            });

            
        }

//           loadRandomBook();//populate upon loading the page
           
           $('#newBookBtn').click(function(){
               loadRandomBook();
           });




        $.getJSON( "./test.json", function( data ) {
          var items = [];
          $('#test').html('<p>' + data.foo + '</p>'
            + '<p>' + data.baz[1] + '</p>');
          
        });
      
    });
    </script>
  </head>
  <body>

    <div class="container">
      <div class="row">
        <h1>The Bookinator</h1>
      </div>
      <div class="row">
        <p>Need a break from studying? Use the Bookinator to generate a random book from Galvin's Leisure Reading collection.</p>
        <h2>Here's a random book:</h2>
      </div>
      <div class="row">
        <div class="col-md-2"><h3>Title</h3></div>
        <div id="bookTitle" class="col-md-10"></div>
      </div>      <div class="row">
        <div class="col-md-2"><h3>Author:</h3></div>
        <div id="bookAuthor" class="col-md-10"></div>
      </div>
      <div class="row">
        <div class="col-md-2"><h3>Description:</h3></div>
        <div id="bookDescText" class="col-md-10"></div>
      </div>
      <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-10">
          <div id="showOPACbtn"></div>
          <div id="newBookBtn"></div>
        </div>
      </div
    </div>
    <div id="test"></div>
  </body>
</html>
